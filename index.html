<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡ K ç·šå‹æ…‹å¿«ç¯©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; }
        .card { margin-bottom: 15px; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .pattern-tag { background-color: #e3f2fd; color: #0d6efd; padding: 2px 8px; border-radius: 4px; font-size: 0.9em; margin-right: 5px; display: inline-block; margin-top: 5px; }
        .data-label { font-weight: bold; color: #6c757d; }
        .price-up { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h3 class="text-center mb-4">ğŸ“ˆ å°è‚¡æŠ€è¡“å‹æ…‹æŸ¥è©¢</h3>
    
    <div class="input-group mb-4">
        <input type="text" id="searchInput" class="form-control" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ (ä¾‹å¦‚: 2330)">
        <button class="btn btn-primary" type="button" onclick="searchStock()">æŸ¥è©¢</button>
    </div>
    
    <div class="alert alert-warning" id="liveQueryHint" style="display:none;">
        **æ³¨æ„ï¼š** æ‚¨æŸ¥è©¢çš„ **<span id="hintCode"></span>** ä¸åœ¨è³‡æ–™åº«ä¸­ã€‚
        <br>æœ¬ç¶²é æ˜¯æ¯æ—¥å®šæ™‚æ›´æ–°çš„**éœæ…‹**è³‡æ–™ã€‚å¦‚éœ€å³æ™‚æŸ¥è©¢ï¼Œéœ€è¦å»ºç½®é¡å¤– API æœå‹™ã€‚
        <a href="https://goodinfo.tw/tw/StockDetail.asp?STOCK_ID=" target="_blank" id="liveQueryLink">è«‹ç›´æ¥å‰å¾€ Goodinfo æŸ¥è©¢ã€‚</a>
    </div>

    <div id="resultArea">
        <div class="alert alert-info">
            è«‹è¼¸å…¥ä»£è™ŸæŸ¥è©¢ã€‚è³‡æ–™æ›´æ–°æ—¥æœŸï¼š<span id="dataDate">è®€å–ä¸­...</span>
            <p><small>* æœ¬è³‡æ–™åº«åªåŒ…å«é è¨­è‚¡ç¥¨æ¸…å–®ï¼Œæ¯æ—¥æ›´æ–°ä¸€æ¬¡ã€‚</small></p>
        </div>
    </div>
</div>

<script>
    let stockData = {};
    const resultArea = document.getElementById('resultArea');
    const liveQueryHint = document.getElementById('liveQueryHint');

    // 1. ç¶²é è¼‰å…¥æ™‚ï¼Œè®€å– JSON è³‡æ–™
    fetch('stock_data.json')
        .then(response => response.json())
        .then(data => {
            stockData = data;
            const firstKey = Object.keys(data)[0];
            if(firstKey) {
                document.getElementById('dataDate').innerText = data[firstKey].date;
            }
        })
        .catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('dataDate').innerText = 'å¤±æ•— (è«‹æª¢æŸ¥ Actions)';
        });

    // 2. æœå°‹åŠŸèƒ½
    function searchStock() {
        const input = document.getElementById('searchInput').value.trim();
        
        if (!input) return;

        if (stockData[input]) {
            // æ‰¾åˆ°è³‡æ–™ï¼Œé¡¯ç¤ºçµæœ
            liveQueryHint.style.display = 'none';
            const data = stockData[input];
            const patternHtml = data.patterns.map(p => `<span class="pattern-tag">${p}</span>`).join('');
            
            resultArea.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">${input} - ${data.name}</h4>
                        <div class="row mb-3">
                            <div class="col-6"><span class="data-label">æ”¶ç›¤åƒ¹:</span> <span class="price-up">${data.price}</span></div>
                            <div class="col-6"><span class="data-label">æ›´æ–°æ—¥æœŸ:</span> ${data.date}</div>
                        </div>
                        
                        <hr>
                        
                        <div class="row mb-3">
                            <div class="col-12"><span class="data-label">ä¸‰å¤§æ³•äºº (è²·è³£è¶…):</span> ${data.investor_net}</div>
                        </div>
                        
                        <h6>Kç·šæŠ€è¡“å‹æ…‹ï¼š</h6>
                        <div class="mb-2">${patternHtml}</div>
                        
                        <div class="mt-3">
                            <small class="text-muted">å‰å¾€å¤–éƒ¨ç¶²ç«™æŸ¥è©¢å³æ™‚è³‡æ–™ï¼š</small><br>
                            <a href="https://histock.tw/stock/${input}" target="_blank">HiStock</a> | 
                            <a href="https://goodinfo.tw/tw/StockDetail.asp?STOCK_ID=${input}" target="_blank">Goodinfo</a>
                        </div>
                    </div>
                </div>
            `;
        } else {
            // æ‰¾ä¸åˆ°è³‡æ–™ï¼Œé¡¯ç¤ºå³æ™‚æŸ¥è©¢æç¤º
            resultArea.innerHTML = '';
            document.getElementById('hintCode').innerText = input;
            document.getElementById('liveQueryLink').href = `https://goodinfo.tw/tw/StockDetail.asp?STOCK_ID=${input}`;
            liveQueryHint.style.display = 'block';
        }
    }
</script>

</body>
</html>
